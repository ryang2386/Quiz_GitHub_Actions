# Name of workflow
name: Cypress workflow

# Trigger workflow on all pull requests
on:
    pull_request:
        branches:
        - develop

# Jobs to carry out
jobs:
    test:
        # Operating system to run job on
        runs-on: ubuntu-latest
        services:
            mongo:
                image: mongo:latest
                ports:
                    - 27017:27017
                options: >-
                    --health-cmd "mongo --eval 'db.adminCommand(\"ping\")'"
                    --health-interval 10s
                    --health-timeout 5s
                    --health-retries 5
                # wait for mongo to be ready before running tests
                # healthcheck:
                #   test: echo "Mongo is up"
                #   interval: 10s
                #   timeout: 5s
                #   retries: 3

    # Steps in job
        steps:
    # Get code from repo
        - name: Checkout code
          uses: actions/checkout@v3

        - name: Use Node.js 21.x
          uses: actions/setup-node@v4
          with:
            node-version: 21.x

        # Install dependencies
        - name: ðŸ§° install deps
          run: npm install
            
        # Run build
        - name: Run Build
          run: npm run build
          
        # Install Cypress
        - name: Install Cypress
          uses: cypress-io/github-action@v6
          with:
            start: npm run start
            wait-on: 'http://localhost:3001'
        #   run: npm install cypress --save-dev

        # # Run tests
        # - name: Run Tests
        #   run: npm run test

        # # Run Cypress tests
        # - name: Run Cypress Tests
        #   run: npx cypress run